(function(f){"function"===typeof define&&void 0!==define.S?define(function(){return f}):this.Dialog=f})(function(f){function c(a){this.o();this.create(a);return this.callee}var k=/<script(\s|\S)*?(\s|\S)*?<\/script(\s|\S)*?>/g,m=/<script(\s|\S)*?>|<\/script(\s|\S)*?>/g,n=Object.prototype.hasOwnProperty,p=new DOMParser,l=Object.create(null);c.prototype.o=function(){this.b=!1;this.m=this.url=null;this.A=[];this.a=[];this.callee=Object.create(null);this.scope={self:null,state:{}};this.message={T:this.onMessage.bind(this)};
this.u=Object.create(null);this.h={};this.c=null;this.i={}};c.prototype.B=function(a){for(var b in a)n.call(this,b)&&(this[b]=a[b])};c.prototype.R=function(a){if(void 0==a)throw new SyntaxError('[Dialog] "option" is required ');if(void 0==a.url)throw new SyntaxError('[Dialog] option\'s prop is required: "url" ');};c.prototype.N=function(a){var b=this,d;a.some(function(e,g){d=p.parseFromString(e,"application/xml").childNodes[0];if(d.hasAttribute("dialog-type")&&"constructor"===d.getAttribute("dialog-type"))return b.c=
b.s(e.replace(m,"")),a.splice(g,1),!0})};c.prototype.create=function(a){this.R(a);this.B({b:!1,url:a.url,callee:{create:this.create.bind(this),v:this.v.bind(this),clear:this.clear.bind(this),postMessage:this.postMessage.bind(this),l:this.l.bind(this)},i:a.I?this.j(a.I):{}});var b=this;f.then("create",function(d){b.F(b.url,function(e){var g=e.replace(k,"");e=e.match(k);b.N(e);e=e.map(function(h){return b.s(h.replace(m,""))});b.B({m:g,A:e});d()})});f.then("runConstructor",function(d){this.c?this.c(null,
null,this.C.bind(this,d)):d()}.bind(this))};c.prototype.C=function(a,b){b(this.P.bind(this,a),this.i)};c.prototype.v=function(a,b){if(!this.b){var d=this;f.then("render",function(e){-1===d.a.indexOf(a)&&d.a.push(a);b&&(d.h=b);d.K(a);d.O(a);d.L();e()});return this.callee}};c.prototype.clear=function(a){if(!this.b){var b=this;f.then("clear",function(d){var e=a?[a]:b.a,g;e.forEach(function(h){for(g=document.getElementById(h);g.firstChild;)g.removeChild(g.firstChild)});b.a=e.filter(function(h){return-1===
b.a.indexOf(h)});d()})}};c.prototype.l=function(){this.clear();this.o();this.b=!0};c.prototype.K=function(a){var b=document.getElementById(a);if(null==b)throw Error('not found element: "'+a+'"');b.innerHTML=this.m};c.prototype.L=function(){this.A.forEach(function(a){a(this.message,this.J.bind(this))}.bind(this))};c.prototype.J=function(a){a.call(this.scope,this.j(this.h));this.h=null};c.prototype.s=function(a){return Function("message","renderConstructor","dialogConstructor",a)};c.prototype.F=function(a,
b){var d=this;if(d.G(a))b(d.D(a));else{var e=new XMLHttpRequest;e.open("get",a,!0);e.onload=function(g){d.M(a,g.target.response);b(g.target.response)};e.send()}};c.prototype.j=function(a){if("string"===typeof a)var b=a;else{b={};for(var d in a)b[d]=a[d]}return b};c.prototype.O=function(a){this.scope.self=document.getElementById(a).querySelector("[dialog-root]")};c.prototype.P=function(a,b){this.scope.state=b;a()};c.prototype.onMessage=function(a,b){this.u[a]=b};c.prototype.postMessage=function(a,
b){this.b||this.u[a].call(this.scope,b)};c.prototype.G=function(a){return n.call(l,a)};c.prototype.M=function(a,b){l[a]=b};c.prototype.D=function(a){return l[a]};return c}(function(){function f(){this.f=!1;this.g=[]}f.prototype.then=function(c,k){this.g.push(k);this.w()};f.prototype.w=function(c){!this.f&&0<this.g.length&&(this.f=!0,this.g.shift()(this.H(),c))};f.prototype.H=function(){return function(c){this.f=!1;this.w(c)}.bind(this)};return new f}()));